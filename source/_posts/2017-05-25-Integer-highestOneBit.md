---
layout: post
title:  Integer的highestOneBit方法源码解析
date: 2017-05-25 16:21:39
comments: true
ads: true
categories: [软件技术]
tags: [Java,JDK 源码,Collection]
---

在读HashMap源码的时候，遇到了Integer的highestOneBit静态方法不是太理解，所以就读了一下源码，这里记录一下。

JDK的注释中说

> 返回具有至多單個 1 位的 int 值，在指定的 int 值中最高位（最左邊）的 1 位的位置。如果指定的值在其二進制補碼表示形式中不具有 1 位，即它等於零，則返回零。

用人话说

+ 如果一个数是0, 则返回0；
+ 如果是负数, 则返回 -2147483648：【1000,0000,0000,0000,0000,0000,0000,0000】(二進制表示的數)；
+ 如果是正数, 返回的则是跟它最靠近的比它小的2的N次方

<!-- more -->

比如 17：

二进制是【0000,0000,0000,0000,0000,0000,0001,0001】

highestOneBit(17)返回的是最高位的1个1, 其它全是0 的二进制數：【0000,0000,0000,0000,0000,0000,0001,0000】，其实就是16。

```java
    /**
     * 将一个整数（二进制）设置最高位为1，其它位为0，然后返回改变后的值
     * 如果这个整数是0返回0
     * @param i
     * @return
     */
    public static int highestOneBit(int i) {
        // 例如1000
        i |= (i >>  1); // 使前2位变为1，相当于i = i | (i >> 1); i = 1000 | 0100 = 1100
        i |= (i >>  2); // 使前4位变为1，由于上一步确保了前两位都是1，所以这一次移动两位，1111
        i |= (i >>  4); // 使前8位变为1，1111
        i |= (i >>  8); // 使前16位变为1，1111
        i |= (i >> 16); // 使前32位变为1，1111
        return i - (i >>> 1); // i >>> 1 无符号右移，使最高位为0，其余位为1，相减即得出结果，1111 - 0111 = 1000
    }
```

1. ”|“是按位操作符的或操作符，按位操作符有与操作符（&），或操作符（|），异或操作符（^），取反操作符（~），其中运算规则如下：

  - &：两个输入位都为1才会输出1，否则输出0，如：10 & 11 -> 10
  - |：有一个输入位为1就会输出1，如：100 | 110 -> 110
  - ^：如果输入为的某一个是1，但不全都是1，那么输出1，如：110 ^ 100 -> 010
  - ~：这个就不用说了吧

2. ”>>>“是无符号右移操作符，移位操作符分为有符号左移位操作符（<<）、有符号右移位操作符（>>）、无符号右移操作符（>>>）。
有符号左移时低位补0；有符号右移时，若符号为正则高位补0，反之补1；无符号右移操作符无论正负都在高位补0.
